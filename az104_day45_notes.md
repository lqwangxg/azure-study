
# AZ-104 学习笔记 - Day 45

## 📦 Azure Storage 生命周期管理与 Function 自动化

---

## 🧊 Blob 存储访问层（Hot / Cool / Archive）

| 层级     | 特点说明                                                 | 适用场景               |
|----------|----------------------------------------------------------|------------------------|
| Hot      | 存取最频繁，费用高                                       | 活跃读取/写入的数据    |
| Cool     | 读写频率低，存储便宜，但读取稍贵                         | 存档、备份、日志等     |
| Archive  | 最低成本，**读取需解冻（Rehydration）**，耗时数小时       | 法规保留、冷存储       |

---

## 🔁 生命周期管理（Lifecycle Management）

### ✅ 支持的策略操作：
- 自动转层（Hot → Cool，Cool → Archive）
- 自动删除未访问的 Blob
- 策略基于：
  - 上次修改时间（lastModified）
  - 上次访问时间（lastAccessed）

> ❌ 不支持自动从 Archive 还原至 Hot，需手动解冻

---

## 🗂 Azure Files 权限控制

| 功能                       | 说明                                                                 |
|----------------------------|----------------------------------------------------------------------|
| SMB 协议 + AD 集成         | 支持 Azure AD DS / 本地 AD 进行身份认证                            |
| NTFS ACL 权限              | 精细控制用户/组对文件/文件夹的访问权限                              |
| DNS 依赖（AD DS 场景）     | 使用本地 AD 需解析域控制器 DNS，但非强制依赖                       |
| 不支持 POSIX 模型          | POSIX ACL 仅限于 Data Lake Gen2，不适用于标准 Azure Files           |

---

## ⚙️ Function App + Blob Storage 集成场景

### ✅ 典型触发器场景
| 触发事件     | 响应操作示例                                           |
|--------------|--------------------------------------------------------|
| 上传图片     | 自动生成缩略图、压缩                                   |
| 上传发票     | 自动提取信息、写入数据库                               |
| 上传大文件   | 自动归档、通知                                         |

### ❌ 不适合场景
- 定时清理旧数据：应使用 **Timer Trigger + 生命周期策略**

---

## 📡 Blob Trigger vs Event Grid

| 比较点           | Blob Trigger                         | Event Grid                           |
|------------------|--------------------------------------|--------------------------------------|
| 工作机制         | 扫描容器变化（轮询）                | 事件推送（低延迟）                  |
| 延迟             | 高                                   | 低                                   |
| 可扩展性         | 一对一函数绑定                       | 多对多（一个 Topic 多个订阅）       |
| 依赖项           | 不依赖 Change Feed                   | 可与 Change Feed 配合提升能力        |

---

## 🧪 小测验复盘（得分：13 / 20）

### 问题 1：Blob 存储访问层
✅ B, C, D  
❌ A：Archive 并不支持实时读取

### 问题 2：生命周期策略操作
✅ A, B, C  
❌ D：不能自动解冻 Archive

### 问题 3：Azure Files 权限控制
✅ A, B  
❌ C：POSIX ACL 不支持  
❌ D：绑定 DNS 并非强制

### 问题 4：Function + Blob 使用场景
✅ A, C, D  
❌ B：定时清理不应使用 Blob Trigger

### 问题 5：触发机制对比
✅ B, D  
❌ A：Blob Trigger 是轮询机制  
❌ C：不依赖 Change Feed

---

## 🔜 下一步预告 - Day 46 模块

| 模块                     | 内容说明                               |
|--------------------------|----------------------------------------|
| Azure Disk 管理           | 磁盘类型（Standard, Premium, Ultra）   |
| Snapshot & Image 实战    | VM 快照与自定义映像                   |
| 加密与备份策略整合       | 使用 Key Vault / Backup Vault         |
