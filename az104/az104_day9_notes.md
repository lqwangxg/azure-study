# AZ-104 学习笔记 - Day 9：身份与访问控制（IAM / Key Vault）

## 🎯 学习目标

- 理解 Azure 中的 RBAC 权限控制模型
- 掌握作用域层级（订阅、资源组、资源）
- 熟悉用户、组、服务主体、托管身份的差异
- 比较 Key Vault 的访问控制方式（Access Policy vs RBAC）

---

## 🧑‍💼 RBAC 权限模型三要素

- **谁**：用户、组、服务主体、托管身份
- **在什么资源上**：订阅 / 资源组 / 资源
- **拥有何种权限**：Reader / Contributor / Owner 等角色

### 常见内置角色

| 角色                     | 权限说明                   |
|--------------------------|----------------------------|
| Reader                   | 只读                       |
| Contributor              | 所有配置权限（不能授权）   |
| Owner                    | 所有权限 + 授权他人        |
| User Access Administrator| 可授予权限，不能操作资源   |

---

## 👥 身份对象

- **用户**：Azure AD 中的个人
- **组**：统一权限管理的容器
- **服务主体**：代表应用运行身份
- **托管身份（MSI）**：Azure 自动管理的身份，用于安全访问资源（如 Key Vault）

---

## 🔐 Key Vault 权限管理

| 模式         | 优点                 | 适用场景                   |
|--------------|----------------------|----------------------------|
| Access Policy| 精细权限控制         | 老服务兼容或临时授权        |
| RBAC 模式 ✅ 推荐 | 统一权限模型、自动化集成 | 建议优先使用           |

---

## 📦 Key Vault 可管理内容

- **Secret**：API 密钥 / 连接字符串
- **Key**：加解密 / 签名密钥
- **Certificate**：SSL 证书 + 自动续期

---

## ✅ 小测验结果（5/5）

你已完全掌握：

- 角色授权模型和作用域原则
- RBAC vs Access Policy 区别
- 托管身份的典型应用
- Key Vault 访问控制的推荐方式

---

## 🌐 Azure 与 AWS 身份与访问控制机制对比

| 维度             | Azure IAM（RBAC & Key Vault）                | AWS IAM（Identity & Access Management）         |
|------------------|----------------------------------------------|------------------------------------------------|
| 权限模型         | 基于角色的访问控制（RBAC），支持细粒度授权   | 基于策略的访问控制（Policy），支持细粒度授权    |
| 作用域           | 订阅、资源组、资源三级                       | 账户、组织、资源                               |
| 身份类型         | 用户、组、服务主体、托管身份（MSI）           | 用户、组、角色、服务角色                       |
| 临时身份         | 托管身份（MSI），支持自动轮换凭据             | 临时凭证（STS）、角色切换                       |
| 资源授权         | 通过角色分配到资源作用域                      | 通过策略附加到用户/角色/资源                   |
| 密钥管理         | Key Vault（支持 RBAC/Access Policy）          | KMS（Key Management Service）                   |
| 集成与自动化     | 与 Azure AD、Policy、自动化工具深度集成       | 与 AWS Organizations、CloudTrail 集成           |
| 推荐实践         | 优先使用 RBAC，托管身份安全访问资源           | 使用最小权限原则，角色分离，临时凭证            |

**总结：**
- Azure 强调 RBAC 统一权限模型与托管身份自动化，Key Vault 支持多种访问控制方式。
- AWS 以策略为核心，支持跨账户、跨服务的灵活授权，临时凭证机制丰富。
- 两者均支持细粒度权限、密钥管理与合规审计，建议结合实际云平台和安全需求选择最优解。

