
# Azure Monitorï¼šLog Analytics vs Application Insights

## âœ… ä¸€å¥è¯åŒºåˆ†

| åç§° | ä¸€å¥è¯è§£é‡Š |
|------|------------|
| **Log Analytics** | ä¸€ä¸ª **é€šç”¨çš„æ—¥å¿—æŸ¥è¯¢å’Œå­˜å‚¨å¹³å°**ï¼ˆç”¨ KQL åˆ†ææ‰€æœ‰é¥æµ‹æ•°æ®ï¼‰ |
| **Application Insights** | ä¸€ä¸ª **ä¸“æ³¨äºåº”ç”¨æ€§èƒ½å’Œä½¿ç”¨åˆ†æçš„æœåŠ¡**ï¼Œç”¨äº APMï¼ˆApplication Performance Monitoringï¼‰ |

---

## ğŸ§© æ¶æ„å…³ç³»å›¾ï¼ˆé‡ç‚¹ï¼‰

```
                             +-------------------------+
                             |  Application Insights   | â† åº”ç”¨ç¨‹åºé¥æµ‹ï¼ˆAPMï¼‰
                             +-------------------------+
                                          â†“
                            ã€æ”¶é›†ã€‘åº”ç”¨æ—¥å¿—ã€è¯·æ±‚ã€å¼‚å¸¸ã€ä¾èµ– ç­‰
                                          â†“
               +-----------------------------------------------+
               |    Log Analytics Workspaceï¼ˆæ—¥å¿—åˆ†æå¹³å°ï¼‰     |
               +-----------------------------------------------+
                  â†‘        â†‘        â†‘
              VM Agent  AMA/DCR  Container
              ç³»ç»Ÿæ—¥å¿—   ç½‘ç»œæ—¥å¿—   docker è¾“å‡º
```

> âœ… **Application Insights çš„æ•°æ®ï¼Œå…¶å®å°±æ˜¯å­˜å‚¨åœ¨ Log Analytics Workspace ä¸­ï¼**

---

## ğŸ“¦ å…³é”®åŒºåˆ«è¡¨

| é¡¹ç›® | Application Insights | Log Analytics |
|------|----------------------|---------------|
| **ä¸»è¦ç”¨é€”** | åº”ç”¨æ€§èƒ½ç›‘æ§ï¼ˆAPMï¼‰ | æ—¥å¿—åˆ†æå¹³å° |
| **é‡‡é›†å¯¹è±¡** | åº”ç”¨ç¨‹åºï¼ˆFunction Appã€Web Appã€APIï¼‰ | æ‰€æœ‰èµ„æºï¼ˆVMã€å®¹å™¨ã€ç½‘ç»œã€å­˜å‚¨ç­‰ï¼‰ |
| **æ”¯æŒè¯­è¨€** | .NET, Java, Node.js, Python ç­‰ SDK | ä¸åŒºåˆ†è¯­è¨€ï¼Œåªçœ‹æ•°æ®æº |
| **æŸ¥è¯¢è¯­è¨€** | KQLï¼ˆKustoï¼‰ | KQLï¼ˆKustoï¼‰ |
| **æ—¥å¿—è¡¨å** | `requests`, `traces`, `exceptions`, `dependencies` | `Syslog`, `Heartbeat`, `CustomLogs_CL`, `Perf` ç­‰ |
| **æ˜¯å¦å¿…é¡»ä¾èµ– Workspace** | å¯ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯å…³è” Log Analytics | å¿…é¡»ä¾èµ– Workspace |
| **å‘Šè­¦åŠŸèƒ½** | å†…å»ºï¼ˆSmart Detectionã€å¼‚å¸¸è¯†åˆ«ï¼‰ | å¯è‡ªå®šä¹‰æŸ¥è¯¢å‘Šè­¦ |
| **æ”¶è´¹æ¨¡å¼** | æŒ‰æ•°æ®é‡ã€ä¿ç•™å¤©æ•° | åŒä¸Šï¼Œå…±äº«è®¡è´¹ |

---

## ğŸ§  æ›´é€šä¿—ç†è§£

| åœºæ™¯ | åº”è¯¥ç”¨ |
|------|--------|
| æˆ‘æƒ³åˆ†æ Function App çš„æ‰§è¡Œæ—¶é—´ã€å¼‚å¸¸å †æ ˆã€è¯·æ±‚é‡ | âœ… Application Insights |
| æˆ‘æƒ³åˆ†æ VM å®¹å™¨æ—¥å¿—ã€ç³»ç»Ÿæ—¥å¿—ã€å®‰å…¨æ—¥å¿— | âœ… Log Analytics |
| æˆ‘å¸Œæœ›ç»Ÿä¸€æ”¶é›†å’ŒæŸ¥è¯¢æ‰€æœ‰æ—¥å¿—ï¼ˆFunction + VM + Storageï¼‰ | âœ… Log Analytics Workspaceï¼ˆç»Ÿä¸€å¹³å°ï¼‰ |
| æˆ‘åªå…³å¿ƒ Web API çš„æ€§èƒ½è¡¨ç° | Application Insights è¶³å¤Ÿ |
| æˆ‘æƒ³ç”¨ KQL æŸ¥è¯¢æ‰€æœ‰èµ„æºäº§ç”Ÿçš„æ—¥å¿— | Log Analytics æ˜¯ä¸»å¹³å°ï¼ˆApp Insights çš„æ•°æ®ä¹Ÿåœ¨é‡Œé¢ï¼‰ |

---

## ğŸ“Œ ç¤ºä¾‹ï¼šFunction App ä½¿ç”¨ Application Insights çš„æ—¥å¿—è¡¨

| è¡¨å | å«ä¹‰ |
|------|------|
| `requests` | æ¯ä¸ª HTTP è°ƒç”¨ï¼ˆURLã€å“åº”ç ã€è€—æ—¶ï¼‰ |
| `dependencies` | å¤–éƒ¨ä¾èµ–ï¼ˆAPIã€DBï¼‰è°ƒç”¨ä¿¡æ¯ |
| `exceptions` | é”™è¯¯å †æ ˆ |
| `traces` | åº”ç”¨å†…éƒ¨æ—¥å¿—ï¼ˆconsole.log / loggerï¼‰ |
| `customEvents` | ä½ è‡ªå®šä¹‰çš„äº‹ä»¶ |

---

## ğŸ§ª ç¤ºä¾‹ï¼šKQL æŸ¥è¯¢åº”ç”¨æ—¥å¿—ï¼ˆæ¥è‡ª App Insightsï¼‰

```kql
requests
| where timestamp > ago(1h)
| where success == false
| project name, url, resultCode, duration
```

---

## âœ… æ€»ç»“

| ç»“è®º | æè¿° |
|------|------|
| Log Analytics æ˜¯åº•å±‚â€œæ•°æ®å¹³å°â€ | å®ƒå­˜å‚¨æ¥è‡ª App Insightsã€VMã€Storage ç­‰çš„æ—¥å¿— |
| Application Insights æ˜¯â€œåº”ç”¨ç›‘æ§æœåŠ¡â€ | å®ƒæ”¶é›†åº”ç”¨å±‚çš„é¥æµ‹ä¿¡æ¯ï¼Œåˆ†ææ€§èƒ½ã€å¼‚å¸¸ã€ä¾èµ–ç­‰ |
| æ¨èåšæ³• | æŠŠ Application Insights å’Œ Log Analytics Workspace **å…³è”èµ·æ¥ç»Ÿä¸€æŸ¥è¯¢** |
